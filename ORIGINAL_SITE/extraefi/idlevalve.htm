<html><!-- InstanceBegin template="/Templates/template.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<!-- InstanceBeginEditable name="doctitle" -->
<title>ExtraEFI.co.uk HOME</title>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29880327-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- InstanceEndEditable -->
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<script type="text/javascript" language="javascript" src="lytebox.js"></script>
<link rel="stylesheet" type="text/css" href="Main.css" />
<script src="SpryAssets/SpryMenuBar.js" type="text/javascript"></script>
<link rel="stylesheet" href="lytebox.css" type="text/css" media="screen" />
<link href="SpryAssets/SpryMenuBarHorizontal.css" rel="stylesheet" type="text/css">
<link href="SpryAssets/SpryMenuBarVertical.css" rel="stylesheet" type="text/css">
<style type="text/css">
<!--
.style6 {
	color: #FFFFFF;
	font-style: italic;
}
.style10 {font-size: medium}
.style11 {font-size: small}
.style15 {font-size: large}
-->
</style>
<style type="text/css">
<!--
.style18 {font-size: x-large}
-->
</style>
<style type="text/css">
<!--
.style26 {font-size: xx-large}
-->
</style>
<style type="text/css">
<!--
.style27 {color: #000000}
.style28 {color: #EEEEEE}
.style29 {color: #333333}
.style31 {color: #CC0000}
.style16 {color: #CCCCCC}
-->
</style>
<!-- InstanceBeginEditable name="head" -->
<style type="text/css">
<!--
.style1 {	color: #CCCCCC;
	font-style: italic;
}
li.MsoNormal1 {mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:black;}
p.MsoNormal {mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:black;}
li.MsoNormal {mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:black;}
p.MsoNormal1 {mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:black;}
li.MsoNormal11 {mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:black;}
p.MsoNormal2 {mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:black;}
.style36 {	color: #FFFFFF;
	font-weight: bold;
}
.style37 {
	color: #FFFF00;
	font-weight: bold;
}
.style38 {font-size: 18px}
.style39 {color: #FFFFFF}
.style12 {	color: #CCCCCC;
	font-size: small;
	font-weight: bold;
}
.style13 {	font-size: small;
	color: #CCCCCC;
}
.style40 {	font-weight: bold;
	font-size: small;
	color: #CCCCCC;
}
.style19 {	font-size: large;
	color: #000000;
	font-weight: bold;
}
.style21 {color: #000000; font-weight: bold; }
.style8 {font-size: x-large; font-weight: bold; color: #CCCCCC; }
.style9 {	font-size: x-large;
	font-weight: bold;
	color: #CCCCCC;
}
-->
</style>
<!-- InstanceEndEditable --><!-- InstanceParam name="OptionalRegion1" type="boolean" value="true" -->
</head>

<!--COPY FROM HERE-->
<body bgcolor="#fff" text="#000" background="Pix/backing.jpg" link="#000" vlink="#333" alink="#ccc">

<div id="page-wrapper">
    
    <table width="100%" bgcolor="#000">
        <tr>
            <td><class="style10"><a href="http://extraefi.co.uk"><img src="../../WebstormProjects/extraefiNEW/img/new_title2.jpg" width="100%" alt="ExtraEFI" /></a></td>
        </tr>
  </table>
  
    <table bgcolor="#fff" id="MenuBarHorizontal">
        <tr>
            <td bgcolor="#eee"><ul type="circle" class="MenuBarHorizontal style28" id="MenuBar1">
                <li name="lbNavDisplay">
                    <div align="center"><a class="MenuBarItemSubmenu" href="#">Products</a>
              <ul>
                <li>
                  <div align="center"><a href="MS_All_products.htm" class="MenuBarItemSubmenu">Engine Management</a>
                      <ul>
                        <li>
                          <div align="center"><a href="MS_All_products.htm">MegaSquirt ECU's</a></div>
                        </li>
                        <li>
                          <div align="center"><a href="RV8_Kits.html#pnp">RV8 Plug-n-Play</a></div>
                        </li>
                        <li><a href="RV8_Kits.html">V8 Bundles</a></li>
                      </ul>
                  </div>
                </li>
                <li>
                  <div align="center"><a href="Misc_products.htm" class="MenuBarItemSubmenu">Accessories</a>
                      <ul>
                        <li>
                          <div align="center"><a href="Misc_products.htm">Knock Conditioners, Temp Sensors, Relays, Connectors, Trigger Wheels, Looms and much more</a></div>
                        </li>
                      </ul>
                  </div>
                </li>
                <li>
                  <div align="center"><a href="#" class="MenuBarItemSubmenu">ECU Bundles</a>
                      <ul>
                        <li>
                          <div align="center"><a href="RV8_Kits.html">8 Cylinder Engines</a></div>
                        </li>
                        <li>
                          <div align="center"><a href="RV8_Kits.html#pnp">RV8 Plug-n-Play</a></div>
                        </li>
                      </ul>
                  </div>
                </li>
                <li>
                  <div align="center"><a href="RV8_Kits.html#pnp">Rover V8 ECU's</a></div>
                </li>
                <li><a href="MX5.html">Mazda MX5 ECU's</a></li>
              </ul>
          </div>
        </li>
        <li>
          <div align="center"><a href="#" class="MenuBarItemSubmenu">Support</a>
              <ul>
                <li>
                  <div align="center"><a href="support.htm">Help &amp; Support Files</a></div>
                </li>
                <li>
                  <div align="center"><a href="drawings.htm">Drawings &amp; Diagrams</a></div>
                </li>
                <li>
                  <div align="center"><a href="downloads.htm">Download Area</a></div>
                </li>
                <li>
                  <div align="center"><a href="video.html">Video Help</a></div>
                </li>
              </ul>
          </div>
        </li>
        <li>
          <div align="center"><a href="#" class="MenuBarItemSubmenu">FAQ's</a>
              <ul>
                <li>
                  <div align="center"><a href="faq.htm">FAQ's</a></div>
                </li>
                <li>
                  <div align="center"><a href="glossary.htm">Glossary of MegaSquirt Terms</a></div>
                </li>
                <li><a href="Untitled Item">Compare ECU's</a></li>
                <li><a href="information_OL.htm">Still Confused?</a></li>
                <li>
                  <div align="center"><a href="terms.htm#Warranty">ExtraEFI Warranty</a></div>
                </li>
                <li>
                  <div align="center"><a href="terms.htm">Terms of Use for ExtraEFI website</a></div>
                </li>
                <li>
                  <div align="center"><a href="history.htm">ExtraEFI Company Profile</a></div>
                </li>
              </ul>
          </div>
        </li>
        <li>
          <div align="center"><a href="#" class="MenuBarItemSubmenu">Services</a>
              <ul>
                <li> <a href="services.htm">Fitting &amp; Tuning</a></li>
                <li>
                  <div align="center"><a href="services.htm">MegaSquirt Upgrades</a></div>
                </li>
              </ul>
          </div>
        </li>
        <li>
          <div align="center"><a href="#" class="MenuBarItemSubmenu">New Stuff</a>
            <ul>
              <li><a href="MX5.html">MX5 PnP ECU's</a></li>
              <li><a href="Misc_products.htm">Knock Conditioners</a></li>
              <li><a href="Misc_products.htm#usbadap">Built-in USB Port</a></li>
            </ul>
            </div>
        </li>
        <li>
          <div align="center"><a href="gallery.htm">Gallery</a> </div>
        </li>
        <li>
          <div align="center"><a href="feedback.html">Feedback</a></div>
        </li>
        <li>
          <div align="center"><a href="cobra/index.htm">Cobra Replica</a></div>
        </li>
        <li>
          <div align="center"><a href="gallery.htm#links">Links</a></div>
        </li>
      </ul></td>
    </tr>
  </table>

<div id="email-border">
  <p style="font-size: 24px;">Click <a href="mailto:phil@extraefi.co.uk">here</a> to email me if you have any questions</p>
</div>
<!--STOP COPYING HERE-->

<h1>
  Idle Valve Options
</h1>

  <div style="font-size:16px;">
    <table width="100%" bgcolor="#FFFFFF">
      <!-- InstanceBeginEditable name="EditRegion3" -->
      <tr>
        <td width="100%" height="939" bgcolor="#666666"><p align="left"><font color="#000000"><span class="style15">Jump To:<br>
                <br>
                <a href="#2wire">2 Wired Valves</a><br>
                <a href="#3wire">3 Wired Valves</a><br>
                <a href="#4wire">4 Wired Valves (Stepper)</a><br>
                <a href="#ms1">MS1 Settings</a><br>
                <a href="#ms2">MS2/MS3 Settings</a><br>
                <br>
                <br>
                <b><a name="2wire"></a>2 Wired Valves</b> <strong>(FIdle wire)</strong></span><br>
                <br>
These valves are wired between an ignition switched 12V and the Megasquirt 
            Idle Valve wire in the loom. (The MS ECU switches ground to make them work.) 
            Make sure the 12v is switched off when the megasquirt is off. Many looms contain 
            a protection diode, leave it there. </font></p>
          <p align="left"><font color="#000000">Some valves will have a spring return 
            mechanism to shut them, others have a spring to open them, so the duty cycle 
            at high and low temps depends if the MS ECU has to drive it open against the 
            spring or shut against the spring. <br>
            If the ECU has to shut the valve down against the spring to reduce air going 
            through it as temp increases then the duty cycle will need to increase with 
            temp, so the value at low temp will be around 0 and the duty at higher temp 
            will be 100 or so. The opposite if the MS ECU has to force the valve open 
            against the spring to increase air flow.</font></p>
          <p align="left"><font color="#000000"><b><a name="3wire" id="3wire"></a></b><span class="style15"><b>3 Wired Valves (FIdle wire) </b></span>e.g. Bosch Valve 
            0280 140 505<br>
            <br>
            Three wired valves can also be made to work via the IdleValve output from 
            an MS1 or an MS2 (Note that all ExtraEFI.co.uk ECU's are modified during the 
            build process so they can drive a valve, standard ECU's can not drive them 
            directly!) The centre pin of the valve goes to an ignition switched +12V, 
            one of the other 2 pins will hold the valve shut when its connected to ground 
            (0V). This pin needs to go to earth via a resistor (30-40Ohms 50W), the other 
            pin goes to the Idle valve output in the wiring loom from the MS ECU.</font></p>
          <p align="left"><font color="#000000">On a 3 wired valve there are effectively 
            2 windings that fight against each other, one opens the other closes it. So 
            we put a resistor in line to ground with one winding, this shuts (or opens 
            it depending on what winding you use) the valve, so its like having a spring 
            holding it one way. The MS ECU then forces it either shut or open, it can 
            do this as the resistor in the other winding limits how much it can force 
            it one way.</font></p>
          <p align="center"><img src="Pix/Bosch-valve.JPG" width="454" height="258"></p>
          <p align="center">&nbsp;</p>
          <p align="center"><img src="Drawings/Idle_Valves.JPG" width="611" height="573"></p>
          <p align="left">&nbsp;</p>
          <p align="center"><img src="Pix/idleRover.JPG" width="450" height="340">&nbsp;&nbsp;&nbsp;&nbsp;<img src="Pix/idleValve.jpg" width="456" height="346"></p>
          <p align="center">&nbsp;</p>
          <p align="left"><font color="#000000"><b><a name="4wire" id="4wire"></a></b><span class="style15"><b>4 Wired Valves</b><strong> (IAC1A-2B) Stepper Motors</strong></span><br>
                <br>
            If you have a 4 wired valve then its a stepper motor, these can NOT be controlled 
            with MS1-Extra, but can be controlled by MS2 and MS3 ECUs. If you want to use the 
            stepper outputs on the MS2 ECU as a programmable output or Boost or NOS, etc, 
            then you may lose the stepper function as there is a limited amount of output 
            pins that can be used. See <a href="compare.htm">HERE</a> for more details on the output pads available. <br>
            If you use a stepper output for an option then you can still  fit a suitable 2 or 3 wired valve from an older vehicle and use the FIdle output. 
            This is the route most people take for MS1 anyhow. (See above)</font></p>
          <p align="left">&nbsp;</p>
          <p align="left"><font color="#000000"><b>Other Idle Valves</b></font><font color="#000000"><br>
                <br>
            There are valves that need no control other than a 12V supply when the ignition 
            is on. These heat up a bi-metalic strip that rotates a plate inside the valve 
            and shuts the air down as the engine heats up, these are known as Extra Air 
            Valves. They are becoming rare and hard to get hold of, they were fitted to 
            various engines, like the Flapper type RV8 EFI's. The Idle Speed has to be 
            controlled with the throttle stop when using these type of valves, as the 
            valve is only used to add air when the engine is cold.<br>
            Here is a Bosch example:</font></p>
          <p align="center"><img src="Pix/bosch-idle.jpg" width="320" height="227"><img src="Pix/auxaireg.gif" width="503" height="270"></p>
          <p align="left">&nbsp;</p>
          <p align="center"><strong><font size="6"><strong><font color="#000000"><b><a name="ms2" id="ms2"></a></b>MS2-Extra and MS3 Idle Valve Settings</font></strong></font></strong><font color="#000000"><br>
          </font></p>
          <p align="left" class="style15"><strong><span class="style18"><font color="#000000"> Algorithm</font></span></strong></p>
          <div align="left"><span class="style9">War</span><span class="style9"></span><span class="style9">mup Only modes:</span> <span class="style16">(These modes are for open loop control, they do not try to control the engine speed using the rpm as a reference, it is simply an open loop mode to increase engine speed during the warmup period using the coolant temperature. Once the engine is warm they can be set to allow a fixed amount of air through to control the idle rpm.)</span>
              <ul style="text-align: center;">
                <li><strong><font color="#000000"><span class="style15">2 or 3 Wired Valves:</span></font></strong>
                    <ul style="text-align: center;">
                      <li><strong><font color="#000000">On/Off Valve </font></strong><font color="#000000">For an on/off fast idle valve (these are rare and only found on old vehicles), you can also set your <em>Fast Idle Threshold</em> if you have installed a fast idle solenoid. Enter a coolant temperature  to turn on the fast idle solenoid. A typical value is 70&ordm; C.  The Fast Idle valve will be activated below this temperature (70&ordm;C)  and turned off above 70&ordm;C. The Fast idle Threshold is independent of  any warm-up enrichment. Fast idle valves generally have one or two  wires, the<em> FIdle</em> output wire is used for these (Pin 30 in the loom)</font> <br>
                          <br>
                      </li>
                    </ul>
                </li>
                <ul style="text-align: center;">
                  <li><font color="#000000"><strong>PWM Warmup</strong>: This is for the 2 or 3 wired valves as found on Ford's, Vauxhalls, VWs from the early 80s and onwards. Many companies used a Bosch valve. These use the<em> FIdle </em>output wire in the loom (Pin 30).</font></li>
                </ul>
                <br>
                <li><font color="#000000"><span class="style15"><strong>4 Wired Idle Valves: </strong></span></font></li>
                <ul style="text-align: center;">
                  <li><font color="#000000"><strong>Idle Air Controller (IAC)</strong>: If you have a stepper motor IAC, you can set ten intermediate steps based on the coolant  temperature to allow a decreasing amount of "extra air" as the engine  warms up. These are set under '<em>Idle Steps</em>' in MegaTune. Stepper motor IACs usually have four wires, use the 4 wires <strong>IAC1A - IAC2B </strong>Click <a href="Drawings/PDF_Files/Stepper_MS2.pdf" target="_blank">here</a> for a wiring diagram</font> <br>
                      <br>
                  </li>
                </ul>
                <ul>
                  <li><font color="#000000"><strong>IAC Stepper Moving Only</strong>: Powers the stepper only when  changes in pintle position are requested. This is the most common type,  it holds its position if not powered, and is difficult to turn by hand.</font><br>
                      <br>
                  </li>
                  <li><font color="#000000"><strong>IAC Stepper Always On</strong>: Powers the stepper at all times. Required if your stepper 'free wheels' when you spin its pintle un-powered with your hand.</font><font color="#000000"><span class="style39"><br>
                          <br>
                  </span></font></li>
                  <li><font color="#000000"><strong>15 Minute IAC</strong>: This operates the IAC stepper motor as  'always on' for 15 minutes, then switches to 'moving only'. This can be  useful in some situations in which the stepper moves unreliably if  moving only at the lower voltages of cranking and warming up, etc.</font></li>
                </ul>
              </ul>
            <p>&nbsp;</p>
            <p><span class="style9">Closed Loop modes:</span> <span class="style16">(These modes use the engine RPM, TPS, MAP and Coolant temperature as feedback to control the engine speed in a closed loop mode)</span></p>
            <blockquote>
                <p><strong><font color="#000000"><span class="style15">2 or 3 Wired Valves:</span></font></strong></p>
              <blockquote>
                  <p><strong><font color="#000000">PWM Closed Loop: </font></strong><font color="#000000"><br>
                    This mode is for a 2 or 3 wired PMW idle valve.</font></p>
                <p><font color="#000000"><strong>IAC Closed Loop Moving Only: </strong><br>
                  This mode only powers the stepper only when  changes in pintle position are requested. This is the most common type,  it holds its position if not powered, and is difficult to turn by hand</font></p>
                <p><font color="#000000"><strong>IAC Closed Loop Always On: </strong><br>
                  Powers the stepper at all times. Required if your stepper 'free wheels' when you spin its pintle un-powered with your hand.<strong><span class="style15"><br>
                  </span></strong></font></p>
              </blockquote>
            </blockquote>
          </div>
          <p align="left"><font color="#000000"> To select the appropriate '<em>Idle Control/Algorithm</em>' for  stepper motor control in MegaTune you may need to do some testing. In  some cases setting the stepper motor to "IAC Stepper Always On" will  cause the IAC to get hot. However setting it to "IAC Stepper Moving  Only", might cause a problem with idle speed changing from one start to  another if the stepper moves freely. </font></p>
          <p align="left"><font color="#000000"> You can test if your IAC is suitable for 'always on' by leaving your  stepper powered on the bench for 15 min or so. If it doesn't feel too  hot to you, then set it to "Always On". Apparently this is what GM  does. But if you want to be safe they should test it on the bench for  15 min or so, or monitor it closely in the car while not moving for at  least 15 minutes, checking the IAC temperature frequently with your  fingers. It may get warm, but it shouldn't burn your fingers just  touching it.</font></p>
          <p align="center"><strong><font color="#CCCCCC" size="4">&nbsp;<img src="Pix/IAC_Graph.png" width="580" height="430"></font></strong></p>
          <div align="left">
            <p><span class="style21"><b>Closed Loop Idle RPM Targets:</b><br>
            </span><span class="style27"> This is the Idle RPM the closed loop code aims for at different coolant temps. At low coolant temps the engine will need to run at a higher RPM than when its up to operational temperature.</span></p>
          </div>
          <img src="Pix/Target_Idle.png" width="560" height="488" style="display: block; margin: auto;">
          <div align="left" class="style27">
            <p><strong>Coolant Based Cranking steps:</strong><br>
              This is to allow more air in when the engine is cold to aid starting. Tuning this will be trial and error, the settings below are from an RV8.</p>
          </div>
          <img src="Pix/Target_Crank.png" style="display: block; margin: auto;" width="462" height="356">
          <p align="center"><strong><font color="#000" size="4"><br>
                  <em>ABOVE - Values shown are from an RV8</em></font></strong></p>
          <br>
          <h2>Idle Control:</h2>
          <p align="center"><strong><font color="#000" size="4"><img src="Pix/MS2_Idle_RV8_2.png" width="654" height="424"><br>
          </font></strong></p>
          <div align="left">
            <p><font color="#000000"><strong>Time Step Size (ms):</strong><br>
            </font><span class="style40">(Both Modes)</span><font color="#000000"> IAC stepper motor nominal time between steps (i.e., 2.5 milliseconds gives pulse frequency of 400 Hz). If your stepper doesn't move very well this could be increased to help.</font></p>
          </div>
          <br>
          <div align="left">
            <p><strong><font color="#000000">Initial Time Step Size (mS):</font><br>
            </strong><span class="style27"> <span class="style40">(Non-Always on modes)</span> This is the delay the ECU will wait from turning the stepper motor outputs back on to actually driving the motor. </span></p>
          </div>
          <div align="left" class="style27">
            <p><strong>Minimum Step Size: </strong><br>
                <font color="#000000"><strong><span class="style13">(</span></strong></font><span class="style40">Both M</span><span class="style40">odes</span><strong><font color="#000000"><span class="style13">)</span></font></strong> The code calculates how much movement is needed depending on the actual RPM or Coolant temp. Setting this to 1 means it will make lots of tiny steps which may not make any difference due to the actual movement generated by the motor. A setting of 4 - 6 is a good starting point for this, meaning it will need to calculate a larger movement (see a bigger discrepency between target points) before it drives the motor.</p>
          </div>
          <div align="left">
            <p><font color="#000000"><strong>Start Value:</strong><br>
                  <strong> <span class="style13">(</span></strong></font><span class="style40">Both M</span><span class="style40">odes</span><strong><font color="#000000"><span class="style13">)</span> </font></strong><font color="#000000">The number of steps applied to shut the valve  at power up. Because the valve could be anywhere on power up, the ECU drives it to its home position, so any steps from this point are from a known position (Closed). To find this value you need to see the Test Mode Page. This value should be  just above the amount of steps the valve needs to go from open to closed, so if its fully open on power up it will reach fully closed. (200-250 is a usual value).</font></p>
          </div>
          <div align="left">
            <p><font color="#000000"><strong>Crank-to-Run Taper Time:</strong><br>
            </font><span class="style40"> (Open Loop Modes)</span><font color="#000000"> This  is the time over which the cranking position of the idle (either the  stepper steps or the PWM%) is moved to match the table value (see  diagram below). Higher values give a higher idle for longer periods,  which can improve starting performance.</font></p>
          </div>
          <p align="left"> </p>
          <div align="left">
            <p><font color="#000000"><strong>Hysteresis (&deg;):</strong><br>
            </font><span class="style40">(Open Loop Modes)</span> <font color="#000000">This input can be  used to avoid continuous motor motion (and wear) for small coolant  temperature changes. Changes to the motor are only made when new  coolant temperature &gt; coolant temperature on the last move, or, new  coolant temperature &lt; (coolant temperature on the last move -  Hysteresis temperature). What this does is allow constant motor motion  while the coolant temperature is rising, but when it peaks, there will  be no further motion unless things cool back down - which is unlikely.</font></p>
          </div>
          <div align="left">
            <p><font color="#000000"><strong><a name="timebased">Time Based After Start (extended warm-up):</a><br>
            </strong><span class="style11"> </span></font><span class="style13"><strong>(Open Loop Modes)</strong></span><font color="#000000"> You should NOT use the Time Based After Start (extended warmup) option  unless you find you need it, and very few will. Disable it by setting  the 'cold temperature to a value lower than you will see in winter. Then this feature will not be used  unless the coolant temperature at startup (ECU first powered on) is  below the figure you enter. This feature is used toward the end of the warmup sequence  when the coolant temperature is close to its final operating  temperature. In this case, fast idle will normally come off, but SOME  cars (very few) may need extended fast idle. An example is a car that  uses heavy weight oil, which is nowhere near at operating temp when the  coolant gets there, plus a hot cam with not enough idle torque to  overcome the oil drag. </font></p>
          </div>
          <p align="left"><font color="#000000"> This feature is implemented by inputting a 'Cold Position' that is the  step position at start of extended warmup, typically about 80% of the  final, fully closed step position. The IAC behaves normally until the  step position commanded from the table just exceeds this Cold position  value (either PWM or stepper). From that point on, the steps are  tapered in so as to reach the last step value in the table over the  'cold taper time' period. (see the diagram). This slows the reduction  in idle air as the engine continues to warm up (increasing the idle  speed for longer than the coolant temperature alone would do). </font></p>
          <div align="left">
            <p><font color="#000000"><strong>Cold Temperature (&deg;):</strong><br>
                  <span class="style13"><strong>(Open Loop Modes)</strong></span> This defines the initial coolant temperature below which the afterstart  taper will be extended, based on the Cold Position and Cold Taper Time.  It should be set fairly cold, generally not more than -10C.</font></p>
          </div>
          <p align="left"> </p>
          <div align="left">
            <p><font color="#000000"><strong>Cold Position (steps):</strong><br>
            </font><span class="style13"><strong>(Open Loop Modes)</strong></span><font color="#000000"> The Idle PWM values at which time based afterstart tapering is  initiated. Note that this value must be higher than the lowest value in  your IAC PWM table, or you can get strange operating results.</font></p>
          </div>
          <p align="left"> </p>
          <div align="left">
            <p><font color="#000000"><strong>Cold Taper Time (sec):</strong><br>
            </font><span class="style13"><strong>(Open Loop Modes)</strong></span><font color="#000000"> This is the number of seconds that MegaSquirt&reg; takes to move from the 'cold position' to the position indicated in the IAC step table for the current coolant temperature.</font></p>
          </div>
          <p align="center" class="style19">PID Control <span class="style16">(Closed Loop Modes)</span></p>
          <p align="left" class="style27"><strong>PID (Proportianal Integral Derivitive) </strong>is a control method widely used in industry to control systems in a closed loop setup. It starts by calculating an error between its current position and the target position, in this case RPM. There are 3 parts to the control system:<br>
              <br>
              <strong>P</strong> <span class="style16">(Proportianal Gain)</span>: Determins the reaction to the current error calculated. <br>
              <strong>I </strong><span class="style16">(Integral Gain)</span>: Determins the reaction based on previous calculations.<br>
              <strong>D</strong> <span class="style16">(Derivitive Gain)</span>: Alters the reaction based on how much the error has changed.</p>
          <p align="left" class="style27">So a<strong> PID</strong> setup weighs these reactions together and gives a calculated output for the difference in engine speed.</p>
          <p align="left" class="style27"><img src="Pix/IAC_3.png" width="752" height="536"></p>
          <blockquote>
            <blockquote>
              <p align="left" class="style27"><strong>PID Delay:</strong><br>
                Delay the ECU waits for all conditions to enter closed loop to be satisfied before entering closed loop. 1-3S is usually best here.</p>
              <p align="left" class="style27"><strong>Crank to Run Taper:</strong><br>
                The ECU positions the idle valve at a fixed position during cranking (See the IAC Cranking Table). Once the engine starts the IAC will need to take up the closed loop position, this is the delay to allow for a smooth transition from cranking position to closed loop position.</p>
              <p align="left" class="style27"><strong>PID Ramp to Target Time:</strong><br>
                This is how long the code will take for it to reach the target RPM once in closed loop. Larger times here can allow you to increase the P of the PID control. A value of 2-3S works well here.</p>
              <p align="left" class="style27"><strong>PID Controller Interval:</strong><br>
                How often the code for closed loop runs, 80-100mS is a good starting point.</p>
              <p align="left" class="style27"><strong>Proportianal Gain:</strong><br>
                This is best kept reasonably low to stop hunting. <span class="style16">See the description for PID Control above.</span></p>
              <p align="left" class="style27"><strong>Integral Gain:</strong><br>
                This is the gain based on previous calculations, try to keep this over 100%. <span class="style16">See the description for PID Control above.</span></p>
              <p align="left" class="style27"><strong>Derivative Gain:</strong><br>
                This is the gain based on how much the error has changed, zero is a good setting here. <span class="style16">See the description for PID Control above.</span></p>
              <p align="left" class="style27"><strong>PID Lockout RPMdot Threshold:</strong><br>
                This should be set just above  the rate of change that the RPM would naturally move at and around idle. If the rate of change goes above this settng it is assumed the engine needs to come out of closed loop mode. This value can be found by looking through datalogs and finding roughly what RPMdot you have just before you enter closed loop and around idle during closed loop. Set this just above the max RPMdot you find, typically 50-150. If you find the closed loop drops out without touching the throttle,  try increasing this a little.</p>
              <p align="left" class="style27"><strong>PID lockout Max Decel Load:</strong><br>
                This should be set so that the ECU doesn't go into closed loop mode during overrun (engine in gear during decel). During overrun the throttle will be at zero and the ECU could assume the engine is idling too high and therefore close the idle valve (to reduce the amount of air and bring the engine speed down). When the clutch is then pressed in, the engine will no longer be turning through the car's inertia and the idle valve could be closed causing the engine to stall. This setting is to stop the closed loop starting to work during overrun. To find the ideal value, find the KPa value of the MAP at idle and set this to 5 KPa less than the idle MAP, so if you idle at 45KPa set this to 40KPa.<br>
              </p>
            </blockquote>
          </blockquote>
          <blockquote>
            <blockquote>
              <p align="left" class="style27"><strong>Idle Open Duty/Steps:</strong><br>
                This is the value needed to open the valve fully (allow max air through it).</p>
              <p align="left" class="style27"><strong>Idle Valve Closed Duty/Steps:</strong><br>
                This is the value the code runs the valve to when it goes out of closed loop mode (minimum air flow). To tune this, increase the throttle at idle to just over your <em>Idle Activation threshold</em> (e.g. TPS 1.5%) so the code no longer runs closed loop. The idle valve will then shut to this position. If the engine tries to stall then increase this value. This helps for very slow driving in traffic. (Adjust the <em>RPM with valve closed value</em> to just below the RPM you find this setting gives you, see above).</p>
              <p align="left" class="style27"><strong>Idle Activation RPM Adder:</strong><br>
                The ECU can enter closed loop mode even when on overrun if the engine speed is within this Idle Activation Adder value + the target rpm value. So if your idle target is 900RPM and Idle Activation Adder is 200 then closed loop will begin when the engine speed gets to 900+200=1100RPM. Ideally this needs to be set failry low, 50-150 is typical. (Note that if the Idle TPS Activation threshold isn't satisfied then it will NOT enter closed loop).</p>
              <p align="left" class="style27"><strong>Idle Activation TPS Threshold:</strong><br>
                This is the value te TPS must be below to enter closed loop. It is very important to calibrate the TPS correctly and set this to as low a value as you reliably acheive when the throttle is at rest. 0.5-1.0%.</p>
              <p align="left" class="style27"><strong>Dashpot Adder:</strong><br>
                The code remembers it's last good value that it had control of the engine speed. This value is added to the last good value for its starting point next time the throttle is lifted. A value of 5-15 is a good starting point, this helps to get the valve close to where it should be when entering closed loop.</p>
              <p align="left" class="style27"><strong>Closed Delay:</strong><br>
                The ECU closes the air valve after leaving the open loop mode (once TPS rises), this is the delay for that to happen (see <em>Idle Valve Closed Duty</em>).</p>
            </blockquote>
          </blockquote>
          <p align="center"><a href="Drawings/PDF_Files/idle_valves.pdf" target="_blank">PDF 
        File of this page</a></p></td>
      </tr>
      <!-- InstanceEndEditable -->
    </table>
<br>
    <!--Footer-->
    <div id="footer">
    <table width="100%">
      <tr>
        <td height="97" background="Pix/new_title1.jpg"><div align="center"><span style="color: #fff;">Content &copy; 
        <a href="http://www.extraefi.co.uk" style="color: #fff;">ExtraEFI</a>. All Rights Reserved.</span><br>
                  <a href="terms.htm" style="color: #fff;">Terms of Use.</a><br>
                  <span style="color: #fff;">Layout of this website was worked on by</span> <a href="http:chrisbrighton.co.uk" target="_blank" style="color: #fff;">
                  Chris Brighton.</a></span></div></td>
      </tr>
    </table>
    </div>

<script type="text/javascript">
<!--
var MenuBar1 = new Spry.Widget.MenuBar("MenuBar1", {imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
//-->
</script>
</body>
<!-- InstanceEnd --></html>